# üöÄ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –†–∞—Å—á–µ—Ç –ö–æ–º–∏—Å—Å–∏–π –¥–ª—è –†–∞–∑–Ω—ã—Ö –ü—Ä–æ–¥—É–∫—Ç–æ–≤

**–í–µ—Ä—Å–∏—è:** 1.0
**–î–∞—Ç–∞:** 2025-09-07
**–¶–µ–ª—å:** –ü–æ–∫–∞–∑–∞—Ç—å, –∫–∞–∫ —Å–∏—Å—Ç–µ–º–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≥–∏–±–∫–æ —É–ø—Ä–∞–≤–ª—è—Ç—å –∫–æ–º–∏—Å—Å–∏–æ–Ω–Ω—ã–º–∏ —Å—Ç–∞–≤–∫–∞–º–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –±–∏–∑–Ω–µ—Å-–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π, —Ç–∞–∫–∏—Ö –∫–∞–∫ "–ò–ø–æ—Ç–µ–∫–∞" –∏ "–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ".

---

## 1. üéØ –ö–æ–Ω—Ü–µ–ø—Ü–∏—è

–ö–ª—é—á–µ–≤—ã–º —ç–ª–µ–º–µ–Ω—Ç–æ–º —Å–∏—Å—Ç–µ–º—ã —è–≤–ª—è–µ—Ç—Å—è –ø–æ–ª–µ **"–¢–∏–ø –ø—Ä–æ–¥—É–∫—Ç–∞" (`product_type`)** –≤ –∫–∞–∂–¥–æ–π —Å–¥–µ–ª–∫–µ (`Deal`). –ù–∞—à **"–î–≤–∏–∂–æ–∫ –ø—Ä–∞–≤–∏–ª" (Rules Engine)** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ —ç—Ç–æ–≥–æ –ø–æ–ª—è, —á—Ç–æ–±—ã –ø—Ä–∏–º–µ–Ω–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Ñ–æ—Ä–º—É–ª—É –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–º–∏—Å—Å–∏–∏.

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–æ–≤–µ—Ä—à–µ–Ω–Ω–æ —Ä–∞–∑–Ω—É—é –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –¥–ª—è –∏–ø–æ—Ç–µ—á–Ω—ã—Ö –∏ —Å—Ç—Ä–∞—Ö–æ–≤—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞.

## 2. ‚öôÔ∏è –ü–æ—à–∞–≥–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å

### –®–∞–≥ 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤–∏–ª –≤ –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–∏—Å—Ç–µ–º—ã –¥–æ–ª–∂–µ–Ω —Å–Ω–∞—á–∞–ª–∞ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞ —Ä–∞—Å—á–µ—Ç–∞.

1.  **–í–æ–π–¥–∏—Ç–µ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å** (`/admin/`).
2.  –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "–ù–∞–±–æ—Ä—ã –ø—Ä–∞–≤–∏–ª –∫–æ–º–∏—Å—Å–∏–π" (`Commission Rule Sets`).
3.  –°–æ–∑–¥–∞–π—Ç–µ –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –∞–∫—Ç–∏–≤–Ω—ã–π –Ω–∞–±–æ—Ä –ø—Ä–∞–≤–∏–ª.
4.  –í–Ω—É—Ç—Ä–∏ –Ω–∞–±–æ—Ä–∞ –ø—Ä–∞–≤–∏–ª —Å–æ–∑–¥–∞–π—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞.

**–ü—Ä–∏–º–µ—Ä –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**

| –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞ | –£—Å–ª–æ–≤–∏–µ (Condition) | –§–æ—Ä–º—É–ª–∞ (Formula) | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
| :--- | :--- | :--- | :--- |
| **–ò–ø–æ—Ç–µ–∫–∞ (–°—Ç–∞–Ω–¥–∞—Ä—Ç)** | `deal.product_type == 'mortgage'` | `deal.base_amount * Decimal('0.005')` | 20 |
| **–ò–ø–æ—Ç–µ–∫–∞ (–ö—Ä—É–ø–Ω–∞—è)** | `deal.product_type == 'mortgage' and deal.base_amount > 500000` | `deal.base_amount * Decimal('0.0075')`| 10 |
| **–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –∂–∏–∑–Ω–∏** | `deal.product_type == 'insurance'` | `deal.base_amount * Decimal('0.15')` | 30 |

*   **–õ–æ–≥–∏–∫–∞:**
    *   –ï—Å–ª–∏ —Å–¥–µ–ª–∫–∞ ‚Äî **–∫—Ä—É–ø–Ω–∞—è –∏–ø–æ—Ç–µ–∫–∞** (—Å—É–º–º–∞ > ¬£500k), —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª–æ —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º 10, –∏ –∫–æ–º–∏—Å—Å–∏—è —Å–æ—Å—Ç–∞–≤–∏—Ç **0.75%**.
    *   –ï—Å–ª–∏ —Å–¥–µ–ª–∫–∞ ‚Äî **–æ–±—ã—á–Ω–∞—è –∏–ø–æ—Ç–µ–∫–∞**, —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª–æ —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º 20, –∏ –∫–æ–º–∏—Å—Å–∏—è –±—É–¥–µ—Ç **0.5%**.
    *   –ï—Å–ª–∏ —Å–¥–µ–ª–∫–∞ ‚Äî **—Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ**, —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª–æ —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º 30, –∏ –∫–æ–º–∏—Å—Å–∏—è –±—É–¥–µ—Ç **15%** (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ—Ç –≥–æ–¥–æ–≤–æ–π –ø—Ä–µ–º–∏–∏).

### –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ –°–¥–µ–ª–∫–∏ –ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–º

–¢–µ–ø–µ—Ä—å –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—É—é —Å–¥–µ–ª–∫—É —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏–ª–∏ API.

-   **–ü—Ä–∏–º–µ—Ä 1: –ò–ø–æ—Ç–µ—á–Ω–∞—è —Å–¥–µ–ª–∫–∞**
    -   **Base Amount:** ¬£600,000
    -   **Product Type:** `mortgage`

-   **–ü—Ä–∏–º–µ—Ä 2: –°—Ç—Ä–∞—Ö–æ–≤–∞—è —Å–¥–µ–ª–∫–∞**
    -   **Base Amount:** ¬£2,000 (–≥–æ–¥–æ–≤–∞—è –ø—Ä–µ–º–∏—è)
    -   **Product Type:** `insurance`

### –®–∞–≥ 3: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –†–∞—Å—á–µ—Ç –ö–æ–º–∏—Å—Å–∏–∏

–í –º–æ–º–µ–Ω—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–¥–µ–ª–∫–∏ (–º–µ—Ç–æ–¥ `Deal.save()`) –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –º–∞–≥–∏—è:

1.  **–°–∏—Å—Ç–µ–º–∞ –≤—ã–∑—ã–≤–∞–µ—Ç "–î–≤–∏–∂–æ–∫ –ø—Ä–∞–≤–∏–ª"** (`rules_engine.calculate_commission_amount(deal)`).
2.  –î–≤–∏–∂–æ–∫ –Ω–∞—Ö–æ–¥–∏—Ç –∞–∫—Ç–∏–≤–Ω—ã–π –Ω–∞–±–æ—Ä –ø—Ä–∞–≤–∏–ª.
3.  –û–Ω –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ –ø–æ –ø–æ—Ä—è–¥–∫—É –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞.

-   **–î–ª—è –∏–ø–æ—Ç–µ—á–Ω–æ–π —Å–¥–µ–ª–∫–∏ (¬£600k):**
    1.  –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª–æ "–ö—Ä—É–ø–Ω–∞—è –∏–ø–æ—Ç–µ–∫–∞" (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 10).
    2.  –£—Å–ª–æ–≤–∏–µ `deal.product_type == 'mortgage' and deal.base_amount > 500000` **–∏—Å—Ç–∏–Ω–Ω–æ**.
    3.  –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Ñ–æ—Ä–º—É–ª–∞: `600000 * 0.0075`.
    4.  –í –ø–æ–ª–µ `commission_amount` –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è **¬£4,500**.

-   **–î–ª—è —Å—Ç—Ä–∞—Ö–æ–≤–æ–π —Å–¥–µ–ª–∫–∏ (¬£2k):**
    1.  –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª–æ "–ö—Ä—É–ø–Ω–∞—è –∏–ø–æ—Ç–µ–∫–∞" (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 10). –£—Å–ª–æ–≤–∏–µ –ª–æ–∂–Ω–æ.
    2.  –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª–æ "–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –∏–ø–æ—Ç–µ–∫–∞" (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 20). –£—Å–ª–æ–≤–∏–µ –ª–æ–∂–Ω–æ.
    3.  –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª–æ "–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –∂–∏–∑–Ω–∏" (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 30).
    4.  –£—Å–ª–æ–≤–∏–µ `deal.product_type == 'insurance'` **–∏—Å—Ç–∏–Ω–Ω–æ**.
    5.  –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Ñ–æ—Ä–º—É–ª–∞: `2000 * 0.15`.
    6.  –í –ø–æ–ª–µ `commission_amount` –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è **¬£300**.

### –®–∞–≥ 4: –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

–ú–µ–Ω–µ–¥–∂–µ—Ä –∏–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç –ø–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏ —É–≤–∏–¥–µ—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∫–∞–∂–¥–æ–≥–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è.

-   **API –∑–∞–ø—Ä–æ—Å:** `GET /api/statistics/`
-   **–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞ (—Å–µ–∫—Ü–∏—è `product_breakdown`):**
    ```json
    "product_breakdown": {
        "mortgage": {
            "count": 1,
            "amount": "4500.00"
        },
        "insurance": {
            "count": 1,
            "amount": "300.00"
        }
    }
    ```

## 3. üìã –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ë–ª–∞–≥–æ–¥–∞—Ä—è —Å–≤—è–∑–∫–µ **"–¢–∏–ø –ø—Ä–æ–¥—É–∫—Ç–∞" + "–î–≤–∏–∂–æ–∫ –ø—Ä–∞–≤–∏–ª"**, —Å–∏—Å—Ç–µ–º–∞ –æ–±–ª–∞–¥–∞–µ—Ç –æ–≥—Ä–æ–º–Ω–æ–π –≥–∏–±–∫–æ—Å—Ç—å—é. –û–Ω–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç:
-   –£–ø—Ä–∞–≤–ª—è—Ç—å —Å–ª–æ–∂–Ω–æ–π –∏ —Ä–∞–∑–Ω–æ–π –ª–æ–≥–∏–∫–æ–π –¥–ª—è –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–≥–æ —á–∏—Å–ª–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤.
-   –ò–∑–º–µ–Ω—è—Ç—å –∫–æ–º–∏—Å—Å–∏–æ–Ω–Ω—ã–µ –ø–ª–∞–Ω—ã –±–µ–∑ –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤.
-   –ü–æ–ª—É—á–∞—Ç—å —Ç–æ—á–Ω—É—é –∞–Ω–∞–ª–∏—Ç–∏–∫—É –≤ —Ä–∞–∑—Ä–µ–∑–µ –±–∏–∑–Ω–µ—Å-–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π.

–≠—Ç–æ –∏ –µ—Å—Ç—å –∫–ª—é—á–µ–≤–æ–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ –Ω–∞—à–µ–π enterprise-—Å–∏—Å—Ç–µ–º—ã.
