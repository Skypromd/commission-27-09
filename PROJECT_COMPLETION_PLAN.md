# План завершения проекта: "UK Commission Admin Panel"
# План завершения проекта: "UK Commission Admin Panel"

**Дата создания плана:** 2025-09-13

Этот документ описывает финальные шаги для успешного завершения проекта, основанные на комплексной оценке его текущего состояния. План сфокусирован на достижении максимальной надежности, функциональности и качества продукта.

---

### Шаг 1: Реализация бизнес-логики с полным тестовым покрытием (Приоритет: Критический)

**Цель:** Создать надежный "мозг" системы, который безошибочно рассчитывает комиссию во всех сценариях. Нельзя реализовывать логику без тестов.

**Задачи:**

-   [ ] **Реализовать иерархические бонусы:**
    -   [ ] Реализовать логику начисления бонуса менеджеру от сделок его прямых подчиненных в `CommissionCalculationEngine`.
    -   [ ] Написать Unit-тесты: проверить расчет для менеджера с одним/несколькими подчиненными, случай с отсутствием сделок.

-   [ ] **Реализовать бонусы за производительность:**
    -   [ ] Определить KPI (например, объем продаж за месяц) и реализовать логику повышенной ставки для лучших сотрудников.
    -   [ ] Написать Unit-тесты: проверить, что бонус начисляется при достижении KPI и не начисляется, если KPI не достигнут.

-   [ ] **Реализовать продуктовые модификаторы:**
    -   [ ] Добавить логику, которая начисляет дополнительный бонус за продажу определенных категорий продуктов (например, "инвестиции").
    -   [ ] Написать Unit-тесты: проверить расчет с разными продуктами.

-   [ ] **Реализовать логику возвратов (Clawback):**
    -   [ ] Создать механизм удержания или возврата уже выплаченной комиссии, если сделка была отменена.
    -   [ ] Написать Unit-тесты: проверить срабатывание `Clawback` при изменении статуса сделки.

**Результат:** Полноценный и, что самое важное, **надежный** движок для расчета комиссий.

---

### Шаг 2: Внедрение иерархических прав доступа (Приоритет: Высокий)

**Цель:** Сделать систему полезной для всех ролей, особенно для менеджеров, предоставив им доступ к данным их команд.

**Задачи:**

-   [ ] **Обновить API `get_queryset`:**
    -   [ ] Модифицировать все ключевые ViewSet'ы (`DealViewSet`, `ClientViewSet`, `CommissionViewSet` и т.д.), чтобы менеджеры видели данные своих команд, используя `user.get_descendants(include_self=True)`.

-   [ ] **Написать интеграционные тесты для прав доступа:**
    -   [ ] Создать тестовые сценарии, которые проверяют, что API возвращает правильные данные для разных ролей:
        -   Консультант видит только свои данные.
        -   Менеджер видит данные своей команды.
        -   Администратор видит все данные.

**Результат:** Безопасный API, который гарантирует, что каждый пользователь видит только то, что ему разрешено.

---

### Шаг 3: Автоматизация и фоновые задачи (Приоритет: Средний)

**Цель:** Снизить ручную нагрузку на пользователей и сделать систему проактивной.

**Задачи:**

-   [ ] **Интегрировать Celery и Redis:**
    -   [ ] Настроить Celery для выполнения асинхронных задач.
    -   [ ] Добавить Redis в `docker-compose.yml` в качестве брокера сообщений.

-   [ ] **Создать периодическую задачу для отчетов:**
    -   [ ] Написать задачу, которая раз в неделю/месяц генерирует отчет по комиссиям для команды и отправляет его менеджеру на email.

**Результат:** Автоматизированная система, которая экономит время пользователей и предоставляет важную информацию без запроса.

---

### Шаг 4: Финальная полировка и подготовка к эксплуатации (Приоритет: Низкий)

**Цель:** Довести продукт до состояния, готового к промышленной эксплуатации, улучшив его производительность и удобство интеграции.

**Задачи:**

-   [ ] **Переход на JWT-аутентификацию:**
    -   [ ] Внедрить `djangorestframework-simplejwt` для более гибкой и современной аутентификации, подходящей для SPA-фронтендов.

-   [ ] **Оптимизация производительности API:**
    -   [ ] С помощью `django-debug-toolbar` найти "узкие места" (N+1 проблемы, медленные запросы) в API.
    -   [ ] Оптимизировать запросы с использованием `select_related` и `prefetch_related`.

-   [ ] **Обзор и финализация документации:**
    -   [ ] Проверить и дополнить документацию к API (например, в формате OpenAPI/Swagger), чтобы фронтенд-команде было легко с ним работать.

**Результат:** Быстрый, современный, хорошо документированный и готовый к запуску продукт.
**Дата создания плана:** 2025-09-13

Этот документ описывает финальные шаги для успешного завершения проекта, основанные на комплексной оценке его текущего состояния. План сфокусирован на достижении максимальной надежности, функциональности и качества продукта.