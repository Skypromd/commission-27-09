000000000000000000# План на завтра: "День автоматизации"

**Дата:** 2025-09-14

**Главная цель:** Внедрить в проект систему фоновых задач (Celery), чтобы снять нагрузку с основного приложения и подготовить основу для автоматических действий, таких как рассылка отчетов.

---

### Шаг 1: Интеграция Celery и Redis (Фундамент)

1.  **Установка зависимостей:** Добавить пакеты `celery` и `redis` в файл `backend/requirements.txt`.
2.  **Настройка Celery:**
    -   Создать файл `backend/core/celery.py` для определения и конфигурации нашего Celery-приложения.
    -   Обновить `backend/core/__init__.py`, чтобы Celery запускался вместе с Django.
    -   Прописать настройки для Celery (адрес брокера Redis) в `backend/core/settings.py`.
3.  **Интеграция с Docker:** Добавить в `docker-compose.yml` новый сервис для `celery worker`, который будет следить за задачами и выполнять их.

**Результат шага:** Проект будет готов к созданию и выполнению фоновых задач.

---

### Шаг 2: Создание первой фоновой задачи (Практика)

1.  **Создание файла для задач:** Создать новый файл `backend/apps/commission/tasks.py`.
2.  **Написание задачи:** В этом файле мы создадим нашу первую задачу `generate_and_send_commission_report`. Она будет:
    -   Принимать на вход `user_id` менеджера.
    -   Собирать данные о комиссиях для всей его команды.
    -   Формировать простой текстовый отчет.
    -   Отправлять этот отчет на email менеджера (используя консольный email-бекэнд для отладки).

**Результат шага:** Рабочая фоновая задача, которую можно вызвать из любого места в коде.

---

### Шаг 3: Тестирование и запуск

1.  **Написание Unit-теста:** Создать тест, который проверяет, что задача `generate_and_send_commission_report` корректно вызывается, формирует отчет и "отправляет" email.
2.  **Проверка вручную:** Запустить задачу из `shell` Django, чтобы убедиться, что все компоненты (Django, Celery, Redis) работают вместе как единое целое.

---

**Итог дня:** Мы завершим **Шаг 3** из нашего основного `PROJECT_COMPLETION_PLAN.md`. Проект станет значительно мощнее, так как сможет выполнять сложные и долгие операции в фоновом режиме.